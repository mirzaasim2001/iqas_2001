{% extends "base.html" %}
{% block content %}

<section class="admin-panel">
    <h1>Admin Panel</h1>

    <!-- ADD NICHE -->
    <h3>Add New Niche</h3>
    <form method="post" action="/admin/add-niche">
        <input type="text" name="niche" placeholder="e.g. electronics" required>
        <button>Add Niche</button>
    </form>

    <!-- MANAGE NICHES -->
    <h3>Manage Niches</h3>
    {% for niche in products.keys() %}
    <div class="admin-niche">
        <strong>{{ niche | capitalize }}</strong>

        <form method="post" action="/admin/edit-niche" class="inline-form">
            <input type="hidden" name="old_niche" value="{{ niche }}">
            <input type="text" name="new_niche" placeholder="Rename niche" required>
            <button>Rename</button>
        </form>

        <a href="/admin/delete-niche/{{ niche }}"
           class="danger"
           onclick="return confirm('Delete niche only if empty?')">
           Delete
        </a>
    </div>
    {% endfor %}

    <!-- MANAGE PRODUCTS -->
    <h3>Manage Products by Niche</h3>

    {% for niche, items in products.items() %}
    <div class="admin-niche-block">

        <h4>{{ niche | capitalize }}</h4>

        <!-- ADD PRODUCT FORM -->
        <form method="post" action="/admin/add-product" class="inline-add-form">
            <input type="hidden" name="niche" value="{{ niche }}">

            <input type="text" name="title" placeholder="Product title" required>
            <input type="text" name="price" placeholder="Price" required>
            <input type="text" name="image" placeholder="Main Image URL" required>
            <input type="text" name="link" placeholder="Affiliate link" required>

            <button>Add Product</button>
        </form>

        {% if items %}
            {% for product in items %}
            <div class="admin-product">
                <img src="{{ product.image }}" alt="">

                <div class="admin-product-info">
                    <strong>{{ product.title }}</strong>
                    <p>{{ product.price }}</p>

                    <!-- FEATURE TOGGLE -->
                    <a href="/admin/toggle-feature/{{ product.id }}">
                        {% if product.is_featured %}
                            ⭐ Unfeature
                        {% else %}
                            ☆ Feature
                        {% endif %}
                    </a>

                    <a href="/admin/edit-product/{{ niche }}/{{ product.id }}">
                        Edit Full Details
                    </a>

                    <a href="/admin/delete-product/{{ niche }}/{{ product.id }}"
                       class="danger"
                       onclick="return confirm('Delete this product?')">
                       Delete
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="muted">No products yet. Add one above.</p>
        {% endif %}

    </div>
    {% endfor %}

    <a class="logout" href="/logout">Logout</a>
</section>

{% endblock %}
